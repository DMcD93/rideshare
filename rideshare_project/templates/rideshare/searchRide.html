<!DOCTYPE html>
{% extends 'rideshare/base.html' %}
{% load staticfiles %}
<html lang="en">
<head>
    <meta charset="UTF-8">
		<title>Search Ride</title>
</head>
<body>
{% block body_block %}
	<h1>Search for a Ride</h1>
	
	<!--- <form method="get" action="/results/" class="navbar-form pull-right">
		<input type="text" id="searchBox" class="input-medium search-query" name="timeDB" placeholder="Search">
		<input type="submit" class="btn" value="TimeSearch" >
	</form> --->

	{% if journeys %}
	<div id="journey">
			<table class="table table-striped table-hover ">
				<tr>
					<input class="search form-control" placeholder="Search" size="50" />
					<td><input type="checkbox" id="todaysRides">Todays Rides</input></td>
					<td><input type="checkbox" id="cheapRides">Rides under < Â£5</input></td>				
					<td><input type="checkbox" id="seatNo">Rides with 1+ seats</input></td>
				</tr>
				<td>
					 &nbsp;
				</td>
			</table>
			<table class="table table-striped table-hover ">
				<thead>
				    <tr>
						<th class="active">Departure <button class="btn sort glyphicon-sort pull-right" data-sort="departure"></button></th>
						<th class="active">Destination <button class="btn sort glyphicon-sort pull-right" data-sort="destination"> </button></th>
						<th class="active">Date <button class="btn sort glyphicon-sort pull-right" data-sort="date"> </button></th>
						<th class="active">Time <button class="btn sort glyphicon-sort pull-right" data-sort="time"></button></th>
						<th class="active">Cost <button class="btn sort glyphicon-sort pull-right" data-sort="cost"></button> </th>
						<th class="active">Seats <button class="btn sort glyphicon-sort pull-right" data-sort="seatsAvailable"></button> </th>
						<th class="active"></th>
						<th class="active"></th>
				    </tr>
				</thead>
				<tbody class="list">
					{% for journey in journeys %}
						{% if journey.seatsAvailable >= 1 %}
							<tr>
								<td class="departure ">{{ journey.departure }}</td>
								<td class="destination">{{ journey.destination }}</td>
								<td class="date text-center">{{ journey.travelling_date }}</td>
								<td class="time text-center">{{ journey.travelling_time }}</td>
								<td class="cost text-right">{{ journey.cost }}</td>
								<td class="seatsAvailable text-center">{{ journey.seatsAvailable }}</td>
								<td>
									<form name="book_form" method="post" action="{% url 'search:bookSeat' journey.journey %}">
										{% csrf_token %}
										<input class="btn btn-success" type="submit" name="submit" value="Book" />
									</form>
								</td> 
							</td>
							{% endif %}
							
								<td class="viewride btn-link"> <a href= "/viewRide/">View Ride Details</a></td>
								</tr>
									{% if passangers %}
										{% for passanger in passangers %}
											{% ifequal journey.journey passanger.journey.journey %}
												{% ifnotequal journey.user.get|stringformat:"s" user.get_username  %}
													{% ifnotequal passanger.front|stringformat:"s" user.get_username  %}
														{% ifnotequal passanger.backLeft|stringformat:"s" user.get_username  %}
															{% ifnotequal passanger.backRight|stringformat:"s" user.get_username  %}
																<td>
																	<form name="book_form" method="post" action="{% url 'search:bookSeat' journey.journey %}">
																		{% csrf_token %}
																		<input type="submit" name="submit" value="Book" />
																	</form>
																	</td>
																</td>
															{% endifnotequal %}
														{% endifnotequal %}
													{% endifnotequal %}
												{% endifnotequal %}
											{% endifequal %}
										{% endfor %}
									{% endif %}
								</tr>

					{% endfor %}
				</tbody>
				
			</table>
	{% else %}
		<strong>There are no journeys currently.</strong>
		<a href="/">Return to the homepage.</a><br />
	{% endif %}
	</div>
<script type="text/javascript" src="{% static 'rideshare/list.js' %}"></script>
<script type="text/javascript" src="{% static 'rideshare/journeyFunctions.js' %}"></script>
{% endblock %}
</body>
</html>
